<!DOCTYPE html><html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Advent of Code - Day 15&nbsp;-&nbsp;Worst Practice
    </title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=0">
    <meta name="language" content="en">
    <meta name="robots" content="index,follow">
    <meta name="generator" content="jekyll 3.8.5">
    <meta name="revisit-after" content="7 days">
    <meta name="distribution" content="web">
    <meta name="copyright" content="Copyright © 2022 All rights reserved. Worst Practice.">
    <meta name="description" content="
">
    <meta name="subject" content="">
    <meta name="keywords" content="PHP, Advent of Code">
    <!-- facebook share -->
    <meta property="og:locale" content="en_US">
    <meta property="og:site_name" content="Worst Practice">
    <meta property="og:title" content="Advent of Code - Day 15&nbsp;-&nbsp;Worst Practice
">
    <meta property="og:url" content="https://www.worstpractice.dev/backend/advent-of-code-day-15">
    <meta name="date" content="2022-12-15T14:25:00+00:00">
    <meta property="og:image" content="https://www.worstpractice.dev/assets/img/blog/2022/backend/advent-of-code-day-15/advent-15.jpg">
    <meta property="og:image:width" content="600">
    <meta property="og:image:height" content="600">
    <meta property="og:description" content="This time the game is not the one it looks like for the first sight.">
    <meta property="fb:admins" content="ivan.gabor.80">
    <meta property="fb:app_id" content="2178081495757871">
    <meta property="og:type" content="article">
    <meta property="article:author" content="https://www.facebook.com/ivan.gabor.80">
    <meta property="article:published_time" content="2022-12-15T14:25:00+00:00">
    <meta property="article:tag" content="blog"/>
    <!-- twitter share -->
    <meta name="twitter:title" content="Advent of Code - Day 15">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:creator" content="@gaborivan1980">
    <meta name="twitter:description" content="This time the game is not the one it looks like for the first sight.">
    <meta name="twitter:image" content="https://www.worstpractice.dev/assets/img/blog/2022/backend/advent-of-code-day-15/advent-15_600x600.jpg">
    <link rel="canonical" href="https://www.worstpractice.dev">
    <link rel="alternate" type="application/rss+xml" title="Advent of Code - Day 15&nbsp;-&nbsp;Worst Practice
" href="/feed.xml">
    <link rel="alternate" hreflang="en" href="https://www.worstpractice.dev/backend/advent-of-code-day-15">
    <link rel="apple-touch-icon" sizes="60x60" href="/assets/img/icons/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/assets/img/icons/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/assets/img/icons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/assets/img/icons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/img/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/img/icons/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/img/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/assets/img/icons/android-chrome-192x192.png">
    <link rel="manifest" href="/assets/img/icons/site.webmanifest">
    <link rel="mask-icon" href="/assets/img/icons/safari-pinned-tab.svg" color="#C23F2F">
    <link rel="shortcut icon" href="/assets/img/icons/favicon.ico">
    <meta name="msapplication-TileColor" content="#C23F2F">
    <meta name="msapplication-TileImage" content="/assets/img/icons/mstile-144x144.png">
    <meta name="msapplication-config" content="/assets/img/icons/browserconfig.xml">
    <meta name="theme-color" content="#C23F2F">
    <meta name="application-name" content="Worst Practice Blog">
    <meta name="HandheldFriendly" content="true">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="#C23F2F">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Mono:400">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Libre+Baskerville:300,300i,400,400i,700,700i">
    <link rel="stylesheet" href="/assets/css/site.css">
    <script type="application/javascript" src="/assets/js/feature.min.js"></script>
    <script type="application/javascript">
      if (!feature.srcset) {
          window.location.href = '/sorry.html';
      }
    </script>
    <script type="application/javascript" src="/assets/js/site.min.js"></script>
  </head>
  <body>
    <header class="h-header">
      <h1 class="h-header__title"><a href="/">Worst Practice</a></h1>
    </header>
    <div class="codeOfTheDay">
      <input class="codeOfTheDay__toggle" type="checkbox">
      <div class="codeOfTheDay__content"></div>
      <div class="codeOfTheDay__monitor"></div>
      <div class="codeOfTheDay__backdrop"></div>
    </div>
    <div class="m-menu">
      <div class="m-menu__burger">
        <span></span>
      </div>
      <input class="m-menu__toggle" type="checkbox" />
      <div class="m-menu__content">
        <nav>
          <h2 class="m-menu__title">Worst Practice</h2>
          <ul class="m-menu__navigation">
            <li><a class="m-menu__link -home" href="/">Home</a></li>
          </ul>
        </nav>
        <nav>
          <h2 class="m-menu__title">Categories</h2>
          <ul class="m-menu__navigation">
            <li><a class="m-menu__link -devenv" href="/devenv">Development Environment</a></li>
            <li><a class="m-menu__link -general" href="/general">General</a></li>
            <li><a class="m-menu__link -backend -current" href="/backend">Backend</a></li>
            <li><a class="m-menu__link -frontend" href="/frontend">Frontend</a></li>
            <li><a class="m-menu__link -general
" href="/general
">General</a></li>
          </ul>
        </nav>
        <nav>
          <h2 class="m-menu__title">Tags</h2>
          <ul class="m-menu__navigation">
            <li><a class="m-menu__link -php" rel="tag" href="/tags/php/">PHP <sup>20</sup></a></li>
            <li><a class="m-menu__link -advent" rel="tag" href="/tags/advent/">Advent <sup>15</sup></a></li>
            <li><a class="m-menu__link -php74" rel="tag" href="/tags/php74/">PHP 7.4 <sup>4</sup></a></li>
          </ul>
          <a class="m-menu__link -more" href="/tags/">More</a>
        </nav>
        <nav>
          <h2 class="m-menu__title">Archive</h2>
          <ul class="m-menu__navigation">
            <li><a class="m-menu__link " href="/archive/2023-01/">January, 2023</a></li>
            <li><a class="m-menu__link " href="/archive/2022-12/">December, 2022</a></li>
            <li><a class="m-menu__link " href="/archive/2022-11/">November, 2022</a></li>
          </ul>
          <a class="m-menu__link -more" href="/archive/">More</a>
        </nav>
        <nav>
          <ul class="m-menu__navigation">
            <li><a class="m-menu__link " href="/imprint.html">Imprint</a></li>
            <li><a class="m-menu__link " href="/terms.html">Terms of Use</a></li>
            <li><a class="m-menu__link " href="/privacy.html">Privacy Policy</a></li>
          </ul>
        </nav>
      </div>
      <div class="m-menu__backdrop"></div>
    </div>
    <main class="c-content">
      <section class="c-content__article">
        <article class="a-article">
          <header class="a-header">
            <h2 class="a-header__title">Advent of Code - Day 15</h2>
            <div class="a-header__meta">
              <p class="a-meta__date">Posted on December&nbsp;15, 2022 @ 14:25
              </p>
              <p class="a-meta__category">Posted under the <a href="/backend/index.html">Backend</a> category</p>
              <p class="a-meta__level">Level: intermediate</p>
              <p class="a-meta__tags">Posted with the following tags:
                <a href="/tags/advent/index.html">#Advent</a>, 
                <a href="/tags/php/index.html">#PHP</a>
              </p>
            </div>
          </header>
          <p class="a-excerpt">
            This time the game is not the one it looks like for the first sight.
          </p>
          <figure class="a-illustration">
            <img class="a-illustration__image" src="/assets/img/post-illustration-placeholder.png" data-src="/assets/img/blog/2022/backend/advent-of-code-day-15/advent-15.jpg" alt="Advent of Code - Day 15">
            <figcaption class="a-illustration__caption">Calendar icon by <a target="_blank" rel="noopener" href="https://pixabay.com/users/pinwhalestock-13691058/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=4623521">Kevin Sanderson</a> from <a target="_blank" rel="noopener" href="https://pixabay.com//?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=4623521">Pixabay</a></figcaption>
          </figure>
          <div class="a-body">
            <p><a href="https://adventofcode.com/2022/day/15" rel="noopener" target="_blank">Today’s puzzle</a> in short: we need to calculate
              the <a href="https://en.wikipedia.org/wiki/Taxicab_geometry" rel="noopener" target="_blank">Manhattan distance</a> between
              two points and measure the area you can cover with that distance.</p>
            <p>Something like this:</p>
            <iframe class="yt" width="281" height="500" src="https://www.youtube.com/embed/Wrp4EH5zd9I" title="Advent of code 2022 day 15." frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>
            <h3 id="the-input-data">The input data</h3>
            <p>The input file is short, and basically simple too, if we ignore all the space filling text and just focus on the data:</p>
            <p>Each line contains the following text (variable data is replaced with <code class="language-plaintext highlighter-rouge">#</code>):</p>
            <div class="language-text highlighter-rouge">
              <div class="highlight">
                <pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre>
              </td>
              <td class="rouge-code">
                <pre>Sensor at x=#, y=#: closest beacon is at x=#, y=#
</pre>
              </td>
            </tr>
          </tbody>
        </table>
      </code></pre>
  </div>
</div>
<h3 id="game-rules">Game rules</h3>
<p>Rules are simple:</p>
<ul>
  <li>Distance between coordinates are measured with the Manhattan distance.</li>
  <li>We need to determine every area that will be covered.</li>
</ul>
<h3 id="the-strategy">The strategy</h3>
<p>The difficulty in today’s task is not the calculation itself, but the amount of calculation. We can easily run out of
  process execution time limit, or what is worse: run out of memory.</p>
<p>So we have to do everything to reduce the number of data, that the script have to deal with.</p>
<p>The next important thing is, if you started filling areas like I did in the video, I have a bad news: that’s the wrong
  approach. We have to deal with <strong>ranges</strong>, and we need to merge <strong>ranges</strong> to solve both part one and two.</p>
<h3 id="part-one">Part one</h3>
<p>In part one, the question is how much area is covered by the sensors’ signals on the 2000000th row. This is good hint, that
  we need to focus only one specific line. So when we collect the sensors’ and beacon’s positions from the input data, we
  can immediately calculate whether the covered area reaches the target line or not.</p>
<p>With this trick we can remove more than half of the original data from the upcoming calculations.</p>
<div class="language-php highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre>
  </td>
  <td class="rouge-code">
    <pre><span class="nv">$ranges</span> <span class="o">=</span> <span class="p">[];</span>
<span class="k">const</span> <span class="no">TARGET_ROW</span> <span class="o">=</span> <span class="mi">2000000</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$fn</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="k">__DIR__</span> <span class="mf">.</span> <span class="s1">'/input.txt'</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">while</span> <span class="p">((</span><span class="nv">$line</span> <span class="o">=</span> <span class="nb">fgets</span><span class="p">(</span><span class="nv">$fn</span><span class="p">,</span> <span class="mi">1024</span><span class="p">))</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$line</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="nv">$line</span><span class="p">);</span>

        <span class="nv">$matches</span> <span class="o">=</span> <span class="p">[];</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="s1">'/^Sensor at x=(?P&lt;sensorX&gt;\d+), y=(?P&lt;sensorY&gt;\d+): closest beacon is at x=(?P&lt;beaconX&gt;\d+), y=(?P&lt;beaconY&gt;\d+)$/'</span><span class="p">,</span> <span class="nv">$line</span><span class="p">,</span> <span class="nv">$matches</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$manhattanX</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nv">$matches</span><span class="p">[</span><span class="s1">'sensorX'</span><span class="p">]</span> <span class="o">-</span> <span class="nv">$matches</span><span class="p">[</span><span class="s1">'beaconX'</span><span class="p">]);</span>
            <span class="nv">$manhattanY</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nv">$matches</span><span class="p">[</span><span class="s1">'sensorY'</span><span class="p">]</span> <span class="o">-</span> <span class="nv">$matches</span><span class="p">[</span><span class="s1">'beaconY'</span><span class="p">]);</span>

            <span class="nv">$distance</span> <span class="o">=</span> <span class="nv">$manhattanX</span> <span class="o">+</span> <span class="nv">$manhattanY</span><span class="p">;</span>

            <span class="c1">// If the signal area doesn't reach the target row, skip dealing with it.</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="o">!</span><span class="p">(</span><span class="no">TARGET_ROW</span> <span class="o">&gt;=</span> <span class="nv">$matches</span><span class="p">[</span><span class="s1">'sensorY'</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="no">TARGET_ROW</span> <span class="o">&lt;=</span> <span class="nv">$matches</span><span class="p">[</span><span class="s1">'sensorY'</span><span class="p">]</span> <span class="o">+</span> <span class="nv">$distance</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
                <span class="o">!</span><span class="p">(</span><span class="no">TARGET_ROW</span> <span class="o">&lt;=</span> <span class="nv">$matches</span><span class="p">[</span><span class="s1">'sensorY'</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="no">TARGET_ROW</span> <span class="o">&gt;=</span> <span class="nv">$matches</span><span class="p">[</span><span class="s1">'sensorY'</span><span class="p">]</span> <span class="o">-</span> <span class="nv">$distance</span><span class="p">)</span>
            <span class="p">)</span> <span class="p">{</span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="nv">$distanceDiff</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="no">TARGET_ROW</span> <span class="o">&gt;</span> <span class="nv">$matches</span><span class="p">[</span><span class="s1">'sensorY'</span><span class="p">])</span> <span class="p">{</span>
                <span class="nv">$distanceDiff</span> <span class="o">=</span> <span class="no">TARGET_ROW</span> <span class="o">-</span> <span class="nv">$matches</span><span class="p">[</span><span class="s1">'sensorY'</span><span class="p">];</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="no">TARGET_ROW</span> <span class="o">&lt;</span> <span class="nv">$matches</span><span class="p">[</span><span class="s1">'sensorY'</span><span class="p">])</span> <span class="p">{</span>
                <span class="nv">$distanceDiff</span> <span class="o">=</span> <span class="nv">$matches</span><span class="p">[</span><span class="s1">'sensorY'</span><span class="p">]</span> <span class="o">-</span> <span class="no">TARGET_ROW</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="nv">$targetRowRangeStart</span> <span class="o">=</span> <span class="nv">$matches</span><span class="p">[</span><span class="s1">'sensorX'</span><span class="p">]</span> <span class="o">-</span> <span class="nv">$distance</span> <span class="o">+</span> <span class="nv">$distanceDiff</span><span class="p">;</span>
            <span class="nv">$targetRowRangeStop</span> <span class="o">=</span> <span class="nv">$matches</span><span class="p">[</span><span class="s1">'sensorX'</span><span class="p">]</span> <span class="o">+</span> <span class="nv">$distance</span> <span class="o">-</span> <span class="nv">$distanceDiff</span><span class="p">;</span>

            <span class="nv">$ranges</span><span class="p">[]</span> <span class="o">=</span> <span class="p">[</span><span class="nv">$targetRowRangeStart</span><span class="p">,</span> <span class="nv">$targetRowRangeStop</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="nb">fclose</span><span class="p">(</span><span class="nv">$fn</span><span class="p">);</span>
<span class="p">}</span>
</pre>
  </td>
</tr>
</tbody>
</table>
</code></pre>
</div>
</div>
<p>With a simple regular expression, we can extract the coordinates that we need. Then with a simple algebra we can calculate
  the maximal distance that a sensor can cover. Obviously when the sensor’s <code class="language-plaintext highlighter-rouge">Y</code> coordinate plus the signal distance don’t reach
  the target line, we go on to the next sensor.</p>
<p>Then we have to calculate how much area will be covered on the given line. Simply subtract the two line numbers (the <code class="language-plaintext highlighter-rouge">Y</code> coordinates) 
  and we get how much part of the distance will fall on the target line. With this simple calculation we get the start and 
  end coordinates. And since we talk about one fix line number, we need to remember only the <code class="language-plaintext highlighter-rouge">X</code> coordinates, and the start
  with the end together gives a <strong>range</strong>.</p>
<p>We collect all the ranges we can. Okay but the ranges may overlap! So we need to merge them:</p>
<div class="language-php highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre>
  </td>
  <td class="rouge-code">
    <pre><span class="k">function</span> <span class="n">mergeRanges</span><span class="p">(</span><span class="nv">$ranges</span><span class="p">):</span> <span class="kt">array</span>
<span class="p">{</span>
    <span class="nb">usort</span><span class="p">(</span><span class="nv">$ranges</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="nv">$b</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="p">});</span>

    <span class="nv">$y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nv">$max</span> <span class="o">=</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$ranges</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$max</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$ranges</span><span class="p">[</span><span class="nv">$i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nv">$ranges</span><span class="p">[</span><span class="nv">$y</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$y</span> <span class="o">=</span> <span class="nv">$i</span><span class="p">;</span>
            <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$ranges</span><span class="p">[</span><span class="nv">$y</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nv">$ranges</span><span class="p">[</span><span class="nv">$i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
            <span class="nv">$ranges</span><span class="p">[</span><span class="nv">$y</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$ranges</span><span class="p">[</span><span class="nv">$i</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
        <span class="p">}</span>

        <span class="nb">unset</span><span class="p">(</span><span class="nv">$ranges</span><span class="p">[</span><span class="nv">$i</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nb">array_values</span><span class="p">(</span><span class="nv">$ranges</span><span class="p">);</span>
<span class="p">}</span>

<span class="nv">$usedPositionsOnTargetRow</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="nv">$ranges</span> <span class="o">=</span> <span class="nf">mergeRanges</span><span class="p">(</span><span class="nv">$ranges</span><span class="p">);</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$ranges</span> <span class="k">as</span> <span class="nv">$range</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$usedPositionsOnTargetRow</span> <span class="o">+=</span> <span class="nv">$range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="nv">$range</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">echo</span> <span class="nv">$usedPositionsOnTargetRow</span><span class="mf">.</span><span class="kc">PHP_EOL</span><span class="p">;</span>
</pre>
  </td>
</tr>
</tbody>
</table>
</code></pre>
</div>
</div>
<p>I will be honest: probably I could solve the logic of merging ranges myself, but sometimes I like to be a lazy <em>M.F.</em> and look
  solutions for “simple” problems on the <a href="https://stackoverflow.com/questions/3630500/merging-overlapping-ranges-in-php-arrays" rel="noopener" target="_blank">Stackowerflow</a>.</p>
<p>Anyway, PHP should have a built-in function for this, shouldn’t it?</p>
<p>So we merged the ranges, then we need only count the covered areas.</p>
<h3 id="part-two">Part two</h3>
<p>In part two they twisted on the story and made <strong>every line as target line</strong>. Great, that will definitely eat up the Earth’s
  resources. Luckily they gave some discount on the rules.</p>
<p>Now we have to take consider ranges between 0 and 4000000. And we have to find the one single spot, that is not covered by
  any of the sensor’s signal.</p>
<p>I think, this will be still too much for any average home computer, so we still need to remove as many data as possible.</p>
<div class="language-php highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
</pre>
  </td>
  <td class="rouge-code">
    <pre><span class="nv">$allRanges</span> <span class="o">=</span> <span class="p">[];</span>
<span class="k">const</span> <span class="no">MIN_RANGE_START</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">const</span> <span class="no">MAX_RANGE_STOP</span> <span class="o">=</span> <span class="mi">4000000</span><span class="p">;</span>
<span class="k">const</span> <span class="no">FREQUENCY_MULTIPLIER</span> <span class="o">=</span> <span class="mi">4000000</span><span class="p">;</span>

<span class="nb">set_time_limit</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$fn</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="k">__DIR__</span> <span class="mf">.</span> <span class="s1">'/input.txt'</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">while</span> <span class="p">((</span><span class="nv">$line</span> <span class="o">=</span> <span class="nb">fgets</span><span class="p">(</span><span class="nv">$fn</span><span class="p">,</span> <span class="mi">1024</span><span class="p">))</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$line</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="nv">$line</span><span class="p">);</span>
        <span class="nv">$matches</span> <span class="o">=</span> <span class="p">[];</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="s1">'/^Sensor at x=(?P&lt;sensorX&gt;\d+), y=(?P&lt;sensorY&gt;\d+): closest beacon is at x=(?P&lt;beaconX&gt;\d+), y=(?P&lt;beaconY&gt;\d+)$/'</span><span class="p">,</span> <span class="nv">$line</span><span class="p">,</span> <span class="nv">$matches</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$manhattanX</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nv">$matches</span><span class="p">[</span><span class="s1">'sensorX'</span><span class="p">]</span> <span class="o">-</span> <span class="nv">$matches</span><span class="p">[</span><span class="s1">'beaconX'</span><span class="p">]);</span>
            <span class="nv">$manhattanY</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nv">$matches</span><span class="p">[</span><span class="s1">'sensorY'</span><span class="p">]</span> <span class="o">-</span> <span class="nv">$matches</span><span class="p">[</span><span class="s1">'beaconY'</span><span class="p">]);</span>

            <span class="nv">$distance</span> <span class="o">=</span> <span class="nv">$manhattanX</span> <span class="o">+</span> <span class="nv">$manhattanY</span><span class="p">;</span>
            <span class="nv">$targetRow</span> <span class="o">=</span> <span class="nv">$matches</span><span class="p">[</span><span class="s1">'sensorY'</span><span class="p">]</span> <span class="o">-</span> <span class="nv">$distance</span><span class="p">;</span>

            <span class="k">while</span> <span class="p">(</span><span class="nv">$targetRow</span> <span class="o">&lt;=</span> <span class="nv">$matches</span><span class="p">[</span><span class="s1">'sensorY'</span><span class="p">]</span> <span class="o">+</span> <span class="nv">$distance</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$distanceDiff</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

                <span class="k">if</span> <span class="p">(</span><span class="nv">$targetRow</span> <span class="o">&gt;</span> <span class="nv">$matches</span><span class="p">[</span><span class="s1">'sensorY'</span><span class="p">])</span> <span class="p">{</span>
                    <span class="nv">$distanceDiff</span> <span class="o">=</span> <span class="nv">$targetRow</span> <span class="o">-</span> <span class="nv">$matches</span><span class="p">[</span><span class="s1">'sensorY'</span><span class="p">];</span>
                <span class="p">}</span>

                <span class="k">if</span> <span class="p">(</span><span class="nv">$targetRow</span> <span class="o">&lt;</span> <span class="nv">$matches</span><span class="p">[</span><span class="s1">'sensorY'</span><span class="p">])</span> <span class="p">{</span>
                    <span class="nv">$distanceDiff</span> <span class="o">=</span> <span class="nv">$matches</span><span class="p">[</span><span class="s1">'sensorY'</span><span class="p">]</span> <span class="o">-</span> <span class="nv">$targetRow</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="nv">$targetRowRangeStart</span> <span class="o">=</span> <span class="nv">$matches</span><span class="p">[</span><span class="s1">'sensorX'</span><span class="p">]</span> <span class="o">-</span> <span class="nv">$distance</span> <span class="o">+</span> <span class="nv">$distanceDiff</span><span class="p">;</span>
                <span class="nv">$targetRowRangeStop</span> <span class="o">=</span> <span class="nv">$matches</span><span class="p">[</span><span class="s1">'sensorX'</span><span class="p">]</span> <span class="o">+</span> <span class="nv">$distance</span> <span class="o">-</span> <span class="nv">$distanceDiff</span><span class="p">;</span>

                <span class="c1">// Add ranges only within the limits</span>
                <span class="k">if</span> <span class="p">(</span><span class="nv">$targetRowRangeStart</span> <span class="o">&lt;=</span> <span class="no">MAX_RANGE_STOP</span> <span class="o">&amp;&amp;</span> <span class="nv">$targetRowRangeStop</span> <span class="o">&gt;=</span> <span class="no">MIN_RANGE_START</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">isset</span><span class="p">(</span><span class="nv">$allRanges</span><span class="p">[</span><span class="nv">$targetRow</span><span class="p">]))</span> <span class="p">{</span>
                        <span class="nv">$allRanges</span><span class="p">[</span><span class="nv">$targetRow</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
                    <span class="p">}</span>

                    <span class="nv">$allRanges</span><span class="p">[</span><span class="nv">$targetRow</span><span class="p">][]</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="nb">max</span><span class="p">(</span><span class="no">MIN_RANGE_START</span><span class="p">,</span> <span class="nv">$targetRowRangeStart</span><span class="p">),</span>
                        <span class="nb">min</span><span class="p">(</span><span class="no">MAX_RANGE_STOP</span><span class="p">,</span> <span class="nv">$targetRowRangeStop</span><span class="p">)</span>
                    <span class="p">];</span>
                <span class="p">}</span>
                <span class="nv">$targetRow</span><span class="o">++</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="nb">fclose</span><span class="p">(</span><span class="nv">$fn</span><span class="p">);</span>
<span class="p">}</span>
</pre>
  </td>
</tr>
</tbody>
</table>
</code></pre>
</div>
</div>
<p>Parsing the information works in the same way, but now we collect the ranges from every row and for every sensor.</p>
<p>I already had to increase the time limit, since it will be dead slow. I tell you now, the <code class="language-plaintext highlighter-rouge">$allRanges</code> array will have 
  more than 6 million elements, which elements are many-many arrays of range pairs.</p>
<p>PHP and arrays: straight way into the memory leak hell. But luckily it is still manageable. So we need to run the <code class="language-plaintext highlighter-rouge">mergeRanges()</code>
  function more than 6 million times! God, give me strength!</p>
<p>As the Advent of Code’s challenges are all prepared well, and they don’t want to trick you out or provide multiple possible
  results, we can bravely assume that this task has one, and only one valid result.</p>
<p>This way, when we start merging the ranges, we immediately stop as soon as we get two ranges after the merge. Because it
  means there’s an empty area between them. And because we trust the guys at <em>AoC</em>, we blindly believe the area is exactly
  one specific coordinate and no more.</p>
<div class="language-php highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre>
  </td>
  <td class="rouge-code">
    <pre><span class="k">function</span> <span class="n">mergeRanges</span><span class="p">(</span><span class="nv">$ranges</span><span class="p">):</span> <span class="kt">array</span>
<span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>

<span class="nv">$distressY</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="nv">$distressX</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$allRanges</span> <span class="k">as</span> <span class="nv">$targetRow</span> <span class="o">=&gt;</span> <span class="nv">$ranges</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$ranges</span> <span class="o">=</span> <span class="nf">mergeRanges</span><span class="p">(</span><span class="nv">$ranges</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$ranges</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$distressY</span> <span class="o">=</span> <span class="nv">$targetRow</span>
        <span class="nv">$distressX</span> <span class="o">=</span> <span class="nv">$ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">echo</span> <span class="s2">"Distress signal source: X = </span><span class="nv">$distressX</span><span class="s2">, Y = </span><span class="nv">$distressY</span><span class="s2">, Frequency = "</span><span class="mf">.</span> <span class="p">(</span><span class="nv">$distressX</span> <span class="o">*</span> <span class="no">FREQUENCY_MULTIPLIER</span> <span class="o">+</span> <span class="nv">$distressY</span><span class="p">)</span> <span class="mf">.</span> <span class="kc">PHP_EOL</span><span class="p">;</span>
</pre>
  </td>
</tr>
</tbody>
</table>
</code></pre>
</div>
</div>
</div>
<footer class="a-footer">
  <h3 class="a-footer__title">About the author</h3>
  <a class="a-footer__avatar" href="/author/gabor.ivan/index.html"><img src="/author/gabor.ivan/avatar.jpg" alt="Gábor Iván"></a>
  <p class="a-footer__author">
    Hi, my name is Gábor Iván. I am an old-school Full stack developer, which means I deal with Backend (PHP), Frontend (HTML, CSS, JS), and a little bit of Webdesign. No DevOPS, sorry.
    <br>
    <a href="/author/gabor.ivan/index.html">Read the full story</a>
  </p>
</footer>
</article>
<aside class="a-comments">
  <header class="a-comments__title">
    <h4>It's time to judge me!</h4>
  </header>
  <div id="general">
    There's no embedded tool to judge me in public. But don't worry, you can
    <a class="mailto" href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#119;&#111;&#114;&#115;&#116;&#46;&#112;&#114;&#97;&#99;&#116;&#105;&#99;&#101;&#46;&#98;&#108;&#111;&#103;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;?subject=Judgement on `Advent of Code - Day 15`" target="_blank" rel="noopener" rel="noopener noreferrer">write me</a>
    your opinions/ideas/suggestions in email. Please don't forget to reference the page in the message.
  </div>
</aside>
</section>
</main>
<footer class="f-footer">
  <p class="f-footer__copyright">
    <small>Copyright © 2023 All rights reserved. Worst Practice</small>
  </p>
</footer>
</body>
</html>