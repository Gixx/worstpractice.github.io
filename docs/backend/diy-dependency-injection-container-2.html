<!DOCTYPE html><html lang="en">
  <head>
    <meta charset="utf-8">
    <title>DIY Dependency Injection Container, Part 2&nbsp;-&nbsp;Worst Practice</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=0">
    <meta name="language" content="en">
    <meta name="robots" content="index,follow">
    <meta name="generator" content="jekyll 3.8.5">
    <meta name="revisit-after" content="7 days">
    <meta name="distribution" content="web">
    <meta name="copyright" content="Copyright © 2020 All rights reserved. Worst Practice.">
    <meta name="description" content="">
    <meta name="subject" content="">
    <meta name="keywords" content="PHP 7.4, dependency injection, Clean code, S.O.L.I.D., SOLID Principles, Interface">
    <!-- facebook share -->
    <meta property="og:locale" content="en_US">
    <meta property="og:site_name" content="Worst Practice">
    <meta property="og:title" content="DIY Dependency Injection Container, Part 2&nbsp;-&nbsp;Worst Practice">
    <meta property="og:url" content="https://www.worstpractice.dev/backend/diy-dependency-injection-container-2">
    <meta name="date" content="2020-05-12T10:37:00+02:00">
    <meta property="og:image" content="https://www.worstpractice.dev/assets/img/blog/2020/backend/diy-dependency-injection-container-2/dependency-injection.jpg">
    <meta property="og:image:width" content="600">
    <meta property="og:image:height" content="600">
    <meta property="og:description" content="The second step on our journey to create a stand-alone Dependency Injection Container. Discuss about the configuration doesn&#39;t sound too interesting, but it ...">
    <meta property="fb:admins" content="ivan.gabor.80">
    <meta property="fb:app_id" content="2178081495757871">
    <meta property="og:type" content="article">
    <meta property="article:author" content="https://www.facebook.com/ivan.gabor.80">
    <meta property="article:published_time" content="2020-05-12T10:37:00+02:00">
    <meta property="article:tag" content="blog"/>
    <!-- twitter share -->
    <meta name="twitter:title" content="DIY Dependency Injection Container, Part 2">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:creator" content="@gaborivan1980">
    <meta name="twitter:description" content="The second step on our journey to create a stand-alone Dependency Injection Container. Discuss about the configuration doesn&#39;t sound too interesting, but it ...">
    <meta name="twitter:image" content="https://www.worstpractice.dev/assets/img/blog/2020/backend/diy-dependency-injection-container-2/dependency-injection_600x600.jpg">
    <link rel="canonical" href="https://www.worstpractice.dev">
    <link rel="alternate" type="application/rss+xml" title="DIY Dependency Injection Container, Part 2&nbsp;-&nbsp;Worst Practice" href="/feed.xml">
    <link rel="alternate" hreflang="en" href="https://www.worstpractice.dev/backend/diy-dependency-injection-container-2">
    <link rel="apple-touch-icon" sizes="60x60" href="/assets/img/icons/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/assets/img/icons/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/assets/img/icons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/assets/img/icons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/img/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/img/icons/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/img/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/assets/img/icons/android-chrome-192x192.png">
    <link rel="manifest" href="/assets/img/icons/site.webmanifest">
    <link rel="mask-icon" href="/assets/img/icons/safari-pinned-tab.svg" color="#C23F2F">
    <link rel="shortcut icon" href="/assets/img/icons/favicon.ico">
    <meta name="msapplication-TileColor" content="#C23F2F">
    <meta name="msapplication-TileImage" content="/assets/img/icons/mstile-144x144.png">
    <meta name="msapplication-config" content="/assets/img/icons/browserconfig.xml">
    <meta name="theme-color" content="#C23F2F">
    <meta name="application-name" content="Worst Practice Blog">
    <meta name="HandheldFriendly" content="true">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="#C23F2F">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Mono:400">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Libre+Baskerville:300,300i,400,400i,700,700i">
    <link rel="stylesheet" href="/assets/css/site.css">
    <script type="application/javascript" src="/assets/js/feature.min.js"></script>
    <script type="application/javascript">
      if (!feature.srcset) {
          window.location.href = '/sorry.html';
      }
    </script>
    <script type="application/javascript" src="/assets/js/site.min.js"></script>
  </head>
  <body>
    <header class="h-header">
      <h1 class="h-header__title"><a href="/">Worst Practice</a></h1>
    </header>
    <div class="codeOfTheDay">
      <input class="codeOfTheDay__toggle" type="checkbox">
      <div class="codeOfTheDay__content"></div>
      <div class="codeOfTheDay__monitor"></div>
      <div class="codeOfTheDay__backdrop"></div>
    </div>
    <div class="m-menu">
      <div class="m-menu__burger">
        <span></span>
      </div>
      <input class="m-menu__toggle" type="checkbox" />
      <div class="m-menu__content">
        <nav>
          <h2 class="m-menu__title">Worst Practice</h2>
          <ul class="m-menu__navigation">
            <li><a class="m-menu__link -home" href="/">Home</a></li>
          </ul>
        </nav>
        <nav>
          <h2 class="m-menu__title">Categories</h2>
          <ul class="m-menu__navigation">
            <li><a class="m-menu__link -backend -current" href="/backend">Backend</a></li>
            <li><a class="m-menu__link -frontend" href="/frontend">Frontend</a></li>
            <li><a class="m-menu__link -wsl" href="/wsl">WSL</a></li>
            <li><a class="m-menu__link -general" href="/general">General</a></li>
          </ul>
        </nav>
        <nav>
          <h2 class="m-menu__title">Tags</h2>
          <ul class="m-menu__navigation">
            <li><a class="m-menu__link -php74" rel="tag" href="/tags/php74/">PHP 7.4 <sup>2</sup></a></li>
            <li><a class="m-menu__link -dic" rel="tag" href="/tags/dic/">DIC <sup>2</sup></a></li>
            <li><a class="m-menu__link -clean-code" rel="tag" href="/tags/clean-code/">Clean code <sup>2</sup></a></li>
          </ul>
          <a class="m-menu__link -more" href="/tags/">More</a>
        </nav>
        <nav>
          <h2 class="m-menu__title">Archive</h2>
          <ul class="m-menu__navigation">
            <li><a class="m-menu__link " href="/archive/2020-05/">May, 2020</a></li>
            <li><a class="m-menu__link " href="/archive/2020-04/">April, 2020</a></li>
            <li><a class="m-menu__link " href="/archive/2020-03/">March, 2020</a></li>
          </ul>
          <a class="m-menu__link -more" href="/archive/">More</a>
        </nav>
        <nav>
          <ul class="m-menu__navigation">
            <li><a class="m-menu__link " href="/imprint.html">Imprint</a></li>
            <li><a class="m-menu__link " href="/terms.html">Terms of Use</a></li>
            <li><a class="m-menu__link " href="/privacy.html">Privacy Policy</a></li>
          </ul>
        </nav>
      </div>
      <div class="m-menu__backdrop"></div>
    </div>
    <main class="c-content">
      <section class="c-content__article">
        <article class="a-article">
          <header class="a-header">
            <h2 class="a-header__title">DIY Dependency Injection Container, Part 2</h2>
            <div class="a-header__meta">
              <p class="a-meta__date">Posted on May&nbsp;12, 2020 10:37</p>
              <p class="a-meta__category">Posted under the <a href="/backend/index.html">Backend</a> category</p>
              <p class="a-meta__level">Level: intermediate</p>
              <p class="a-meta__tags">Posted with the following tags:
                <a href="/tags/php74/index.html">#PHP 7.4</a>, 
                <a href="/tags/dic/index.html">#DIC</a>, 
                <a href="/tags/clean-code/index.html">#Clean code</a>, 
                <a href="/tags/yaml/index.html">#YAML</a>
              </p>
            </div>
          </header>
          <p class="a-excerpt">
            The second step on our journey to create a stand-alone Dependency Injection Container. Discuss about the configuration doesn't sound too interesting, but it can hold us some surprises.
          </p>
          <figure class="a-illustration">
            <img class="a-illustration__image" src="/assets/img/post-illustration-placeholder.png" data-src="/assets/img/blog/2020/backend/diy-dependency-injection-container-2/dependency-injection.jpg" alt="DIY Dependency Injection Container, Part 2">
            <figcaption class="a-illustration__caption">Image by Gábor Iván, edited with <a target="_blank" rel="noopener" href="https://www.gimp.org/">Gimp</a>"</figcaption>
          </figure>
          <div class="a-body">
            <p>In the <a rel="prev" href="/backend/diy-dependency-injection-container">previous part</a>, we talked about software engineering principles,
              about the dependency injection and its benefits, and we started to create our own implementation. We’ve finished with the
              Interface so far. In this article we will configuration the configuration data.</p>
            <h3 id="tldr">TL;DR</h3>
            <p>If you don’t want to waste your time reading this tutorial, and you only need a working code sample, please check the source code on
              <a href="https://github.com/Gixx/worstpractice-dependency-injection" target="_blank" rel="noopener">GitHub</a>.</p>
            <h3 id="choose-the-right-weapon">Choose the right weapon</h3>
            <p>You have probably met with the world wide popular <acronym title="YAML Ain't Markup Language">YAML</acronym> file format. If not,
              then I tell you that the YAML is a human friendly data serialization standard for all programming languages. It can look
              something like this:</p>
            <div class="language-yaml highlighter-rouge">
              <div class="highlight">
                <pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre>
              </td>
              <td class="rouge-code">
                <pre><span class="na">services</span><span class="pi">:</span>
  <span class="na">queue</span><span class="pi">:</span>
    <span class="na">class</span><span class="pi">:</span> <span class="s">\Namespace\To\Messaging\Queue</span>
    <span class="na">arguments</span><span class="pi">:</span> 
      <span class="pi">-</span> <span class="s1">'</span><span class="s">%config.host%'</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">%config.user%'</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">%config.password%'</span>

  <span class="s">queu.builder</span><span class="pi">:</span>
    <span class="na">class</span><span class="pi">:</span> <span class="s">\Namespace\To\Messaging\Queue\Builder</span>
    <span class="na">public</span><span class="pi">:</span> <span class="no">false</span>

  <span class="s">some.spooky.service</span><span class="pi">:</span>
    <span class="na">class</span><span class="pi">:</span> <span class="s">\Namespace\To\Spooky\Service</span>
    <span class="na">factory</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">@queue.builder'</span><span class="pi">,</span> <span class="nv">queue</span><span class="pi">]</span>
    <span class="na">calls</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">someMethod</span><span class="pi">,</span> <span class="pi">[</span><span class="s1">'</span><span class="s">some</span><span class="nv"> </span><span class="s">parameter'</span><span class="pi">]]</span>
</pre>
              </td>
            </tr>
          </tbody>
        </table>
      </code></pre>
  </div>
</div>
<p>In general, that would be good for us. But unfortunately it ain’t. Because the PHP has no native support for it. Now I 
  see five options to choose from:</p>
<ol>
  <li>Use the Symfony package, that supports the latest YAML 1.2 standard.</li>
  <li>Use the <acronym title="PHP Extension Community Library">PECL</acronym> extension, that supports only the YAML 1.1 standard.</li>
  <li>Use another third-party PHP library.</li>
  <li>Write our own YAML parser.</li>
  <li>Give a damn and use associative arrays.</li>
</ol>
<p>Well, we already discussed in the previous part, that we don’t want to use any third-party libraries, so option 1 and 3 fell off. 
  Maybe we can’t add PECL extensions to our current setup, so option 2 also fell off. Write an own parser? Waste time to 
  create a complex a codebase that covers the full YAML standard and we maybe don’t even need the half of the YAML’s knowledge?
  And when we think about it, in the end, deep inside all the parsers the whole thing will end up in an average associative 
  array or Iterable class. Then why should we waste our time on this?</p>
<h4 id="pros-of-the-array-based-configuration">Pros of the array-based configuration</h4>
<ul>
  <li>No need to parse: better performance, lower memory consumption. Theoretically.</li>
  <li>It’s raw PHP, you don’t have to learn another syntax.</li>
  <li>You can add closures, which I really hate, but many developers love closures, so it’s a benefit.</li>
</ul>
<h4 id="cons-of-the-array-based-configuration">Cons of the array-based configuration</h4>
<ul>
  <li>The return types probably won’t be recognized by the IDE.</li>
  <li>Difficult to overview the structure.</li>
  <li>For multiple configurations we have to take care of their proper merge.</li>
</ul>
<h3 id="define-the-required-structure">Define the required structure</h3>
<p>In the previous section the YAML code is a perfect example to draw inspiration from it. It describes a clean 
  structure with several behaviours that we will try more or less copy. The YAML is good for many things and not only 
  for dependency injections, which in the most common use-case (Symfony of course) defined under the <code class="highlighter-rouge">services</code> block. 
  But since our configuration will be a PHP array, and we want it to use only for the DI, we skip this level:</p>
<div class="language-php highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre>
  </td>
  <td class="rouge-code">
    <pre><span class="nv">$config</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1">// services</span>
<span class="p">];</span>
</pre>
  </td>
</tr>
</tbody>
</table>
</code></pre>
</div>
</div>
<h4 id="service-identifier">Service identifier</h4>
<p>A service identifier is a string of characters. Oh GOD, you didn’t belive it, did you? It can be a fantasy name as well 
  as a real class name including the <code class="highlighter-rouge">::class</code> constant:</p>
<div class="language-php highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre>
  </td>
  <td class="rouge-code">
    <pre><span class="nv">$config</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'fantasy service name'</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="c1">// ...</span>
    <span class="p">],</span>
    <span class="s2">"</span><span class="se">\\</span><span class="s2">Namespace</span><span class="se">\\</span><span class="s2">To</span><span class="se">\\</span><span class="s2">MyClass"</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="c1">// ...</span>
    <span class="p">],</span>
    <span class="nx">\Namespace\To\Another\Service</span><span class="o">::</span><span class="na">class</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="c1">// ...</span>
    <span class="p">],</span>
<span class="p">];</span>
</pre>
  </td>
</tr>
</tbody>
</table>
</code></pre>
</div>
</div>
<p>The identifiers are the first level keys in the configuration array.</p>
<h4 id="class-reference">Class reference</h4>
<p>A second level key, with single string value. It is a class name or class constant string that points to an instantiatable 
  class. If the service identifier already points to such class, then this sub-key is optional.</p>
<div class="language-php highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre>
  </td>
  <td class="rouge-code">
    <pre><span class="nv">$config</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nx">\Namespace\To\MyService</span><span class="o">::</span><span class="na">class</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="c1">// no need the 'class` key here</span>
    <span class="p">],</span>
    <span class="nx">\Namespace\To\Some\ServiceInterface</span><span class="o">::</span><span class="na">class</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">'class'</span> <span class="o">=&gt;</span> <span class="nx">\Namespace\To\Some\Service</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="s2">"</span><span class="se">\\</span><span class="s2">Namespace</span><span class="se">\\</span><span class="s2">To</span><span class="se">\\</span><span class="s2">AbstractService"</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">'class'</span> <span class="o">=&gt;</span> <span class="nx">\Namespace\To\Another\Service</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="p">],</span>   
<span class="p">];</span>
</pre>
  </td>
</tr>
</tbody>
</table>
</code></pre>
</div>
</div>
<p>This class reference can’t point to another service identifier, because that would be some kind of inheritance, and we
  will handle it in a separate key to make the DIC more fool-proof. So the following code should raise an error:</p>
<div class="language-php highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre>
  </td>
  <td class="rouge-code">
    <pre><span class="c1">// WRONG !!!</span>
<span class="nv">$config</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'some.service'</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">'class'</span> <span class="o">=&gt;</span> <span class="nx">\Namespace\To\Some\Service</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="nx">\Namespace\To\Some\ServiceInterface</span><span class="o">::</span><span class="na">class</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">'class'</span> <span class="o">=&gt;</span> <span class="s1">'some.service'</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">];</span>
</pre>
  </td>
</tr>
</tbody>
</table>
</code></pre>
</div>
</div>
<h4 id="class-constructor-arguments">Class constructor arguments</h4>
<p>Of course the dependency injection makes no sense, when all our services are simple objects without any initial data.
  Yes, we can use <code class="highlighter-rouge">setters</code> instead of constructor arguments, but I think it should be a matter of our own taste. 
  Both the constructor arguments and the setter methods have tops and flops, I won’t discriminate one for the other. I 
  used to keep myself to a simple rule: under a sane amount of parameters I prefer to use constructor arguments.</p>
<div class="language-php highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre>
  </td>
  <td class="rouge-code">
    <pre><span class="nv">$config</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nx">\Namespace\To\Some\ServiceInterface</span><span class="o">::</span><span class="na">class</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">'class'</span> <span class="o">=&gt;</span> <span class="nx">\Namespace\To\Some\Service</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="s1">'arguments'</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">'some parameter'</span>
        <span class="p">],</span>       
    <span class="p">],</span>
<span class="p">];</span>
</pre>
  </td>
</tr>
</tbody>
</table>
</code></pre>
</div>
</div>
<p>That’s all nice, but we want to <strong>inject</strong> classes too. How to separate scalar values from service references? Let’s
  suppose we have the following class:</p>
<div class="language-php highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre>
  </td>
  <td class="rouge-code">
    <pre><span class="kn">namespace</span> <span class="nn">Namespace\To\My\Service</span><span class="p">;</span>

<span class="kn">use</span> <span class="nn">Namespace\To\Some\Service</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">MakesNoSense</span> <span class="p">{</span>
    <span class="cd">/** @var string */</span>
    <span class="k">private</span> <span class="nv">$serviceIdentifier</span><span class="p">;</span>
    <span class="cd">/** @var SomeService */</span>
    <span class="k">private</span> <span class="nv">$service</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$serviceIdentifier</span><span class="p">,</span> <span class="nx">Service</span> <span class="nv">$service</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">serviceIdentifier</span> <span class="o">=</span> <span class="nv">$serviceIdentifier</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">service</span> <span class="o">=</span> <span class="nv">$service</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre>
  </td>
</tr>
</tbody>
</table>
</code></pre>
</div>
</div>
<p>…and we have the corresponding config:</p>
<div class="language-php highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre>
  </td>
  <td class="rouge-code">
    <pre><span class="nv">$config</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'some.service'</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">'class'</span> <span class="o">=&gt;</span> <span class="nx">Namespace\To\Some\Service</span><span class="o">::</span><span class="na">class</span>
    <span class="p">],</span>
    <span class="nx">Namespace\To\My\Service\MakesNoSense</span><span class="o">::</span><span class="na">class</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">'arguments'</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">'some.service'</span><span class="p">,</span>
            <span class="s1">'some.service'</span>
        <span class="p">]</span>   
    <span class="p">]</span>
<span class="p">];</span>
</pre>
  </td>
</tr>
</tbody>
</table>
</code></pre>
</div>
</div>
<p>… then how we should write our DIC to handle this case?</p>
<ul>
  <li>We can use Reflection class to find out the parameter types, but that would go too far, and would make the code 
    unnecessarily complex. And maybe slow too.</li>
  <li>We could use some special character (like <code class="highlighter-rouge">@</code>) to mark class references, as they do in the Symfony YAML configs:
    <div class="language-yaml highlighter-rouge">
      <div class="highlight">
        <pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre>
      </td>
      <td class="rouge-code">
        <pre>  <span class="na">services</span><span class="pi">:</span>
      <span class="s">makes.no.sence.service</span><span class="pi">:</span>
          <span class="na">class</span><span class="pi">:</span> <span class="s">\Namespace\To\Service\MakesNoSense</span>
          <span class="na">arguments</span><span class="pi">:</span>
              <span class="pi">-</span> <span class="s1">'</span><span class="s">some.service'</span>
              <span class="pi">-</span> <span class="s1">'</span><span class="s">@some.service'</span>
</pre>
      </td>
    </tr>
  </tbody>
</table>
</code></pre>
</div>
    </div>
<p>… but this would require an extra <code class="highlighter-rouge">substr</code> or <code class="highlighter-rouge">strpos</code> check.</p>
</li>
<li>Or we can use a straightforward trick to mark which parameter is scalar and which is not.</li>
</ul>
<p>Let’s think about the third option. What do we have in PHP that can differentiate two identical values in an array?</p>
<h5 id="indexes">INDEXES!</h5>
<p>What’s more: <strong>associative indexes</strong>. And since class names are more-or-less self descriptive parameter values, 
  I would say, let’s use an explicit string index (key) for the scalar parameters only. So our previous config will look 
  like this:</p>
<div class="language-php highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre>
  </td>
  <td class="rouge-code">
    <pre><span class="nv">$config</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'some.service'</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">'class'</span> <span class="o">=&gt;</span> <span class="nx">Namespace\To\Some\Service</span><span class="o">::</span><span class="na">class</span>
    <span class="p">],</span>
    <span class="nx">Namespace\To\My\Service\MakesNoSense</span><span class="o">::</span><span class="na">class</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">'arguments'</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">'Service identifier parameter'</span> <span class="o">=&gt;</span> <span class="s1">'some.service'</span><span class="p">,</span>
            <span class="s1">'some.service'</span>
        <span class="p">]</span>   
    <span class="p">]</span>
<span class="p">];</span>
</pre>
  </td>
</tr>
</tbody>
</table>
</code></pre>
</div>
</div>
<p>Amazing! Then in the DIC we only have to check whether the argument definition’s current index is numeric or not, 
  and we will immediately know if we need to keep resolve the dependency for the parameter or just pass it as is.</p>
<h4 id="post-init-calls">Post-init calls</h4>
<p>Sometimes, to fully prepare a service, we need to call a method or to do an additional setup that we can’t necessarily
  do upon initializing the service. A typical example was the NySQL’s <code class="highlighter-rouge">charset</code> option which was ignored prior to PHP 5.3.6
  so we had to set it explicitly:</p>
<div class="language-php highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre>
  </td>
  <td class="rouge-code">
    <pre><span class="nv">$connection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s2">"mysql:host=</span><span class="nv">$host</span><span class="s2">;dbname=</span><span class="nv">$db</span><span class="s2">;charset=utf8"</span><span class="p">,</span>  <span class="nv">$user</span><span class="p">,</span> <span class="nv">$password</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">defined</span><span class="p">(</span><span class="s1">'PHP_VERSION_ID'</span><span class="p">)</span> <span class="o">||</span> <span class="nx">PHP_VERSION_ID</span> <span class="o">&lt;=</span> <span class="mi">50306</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$connection</span><span class="o">-&gt;</span><span class="na">exec</span><span class="p">(</span><span class="s2">"set names utf8"</span><span class="p">);</span>
<span class="p">}</span>
</pre>
  </td>
</tr>
</tbody>
</table>
</code></pre>
</div>
</div>
<p>And since we plan to use PHP 7.4, this example doesn’t valid. Honestly I can’t bring any live example right now. But this
  doesn’t mean there aren’t any. So let’s support it:</p>
<div class="language-php highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre>
  </td>
  <td class="rouge-code">
    <pre><span class="nv">$config</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'form.service'</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">'class'</span> <span class="o">=&gt;</span> <span class="nx">Namespace\To\Form\Service</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="s1">'argument'</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">'action'</span> <span class="o">=&gt;</span> <span class="s1">'login.php'</span><span class="p">,</span>
            <span class="s1">'method'</span> <span class="o">=&gt;</span> <span class="s1">'POST'</span>
        <span class="p">],</span>
        <span class="s1">'calls'</span> <span class="o">=&gt;</span> <span class="p">[</span>           
            <span class="p">[</span><span class="s1">'addElement'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'username'</span><span class="p">,</span> <span class="s1">'value'</span> <span class="o">=&gt;</span> <span class="s1">''</span><span class="p">,</span> <span class="nx">\Namespace\To\Form\Element\TextInput</span><span class="o">::</span><span class="na">class</span><span class="p">]],</span>
            <span class="p">[</span><span class="s1">'addElement'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'password'</span><span class="p">,</span> <span class="s1">'value'</span> <span class="o">=&gt;</span> <span class="s1">''</span><span class="p">,</span> <span class="nx">\Namespace\To\Form\Element\PasswordInput</span><span class="o">::</span><span class="na">class</span><span class="p">]],</span>
            <span class="p">[</span><span class="s1">'addElement'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'submit'</span><span class="p">,</span>  <span class="s1">'value'</span> <span class="o">=&gt;</span> <span class="s1">'Login'</span><span class="p">,</span> <span class="nx">\Namespace\To\Form\Element\SubmitButton</span><span class="o">::</span><span class="na">class</span><span class="p">]],</span>
            <span class="p">[</span><span class="s1">'addValidator'</span><span class="p">,</span> <span class="p">[</span><span class="nx">\Namespace\To\Form\Validator\CredentialValidator</span><span class="o">::</span><span class="na">class</span><span class="p">]],</span>
        <span class="p">],</span>
    <span class="p">],</span>  
<span class="p">];</span>
</pre>
  </td>
</tr>
</tbody>
</table>
</code></pre>
</div>
</div>
<p>So in this example we define the config for a HTML Form service. There are constructor scalar parameters, and instead of
  creating the form by injecting all the necessary elements, we instead add them with public methods. This is just a very
  simple example, but it shows pretty well, how the <code class="highlighter-rouge">calls</code> sub-key is built up:</p>
<ul>
  <li>Every element of the <code class="highlighter-rouge">calls</code> sub-key is an array that defines one single method call.</li>
  <li>The first item of each array is the method name. It must exists as a public method within the class.</li>
  <li>The second item is an array again. It’s the argument list of the method and it’s optional in those cases when the 
    method doesn’t require any parameters. This list behaves the same way as the <code class="highlighter-rouge">argument</code> list for the class.</li>
  <li>One method can be called multiple times.</li>
</ul>
<h4 id="singleton">Singleton</h4>
<p>This one is a simple boolean key, called <code class="highlighter-rouge">shared</code>. If it’s TRUE, it means that the instance will be shared along the 
  runtime whenever we need it. Otherwise a new instance will be returned by the DIC.</p>
<div class="language-php highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre>
  </td>
  <td class="rouge-code">
    <pre><span class="nv">$config</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'some.service'</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">'class'</span> <span class="o">=&gt;</span> <span class="nx">Namespace\To\Some\Service</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="s1">'shared'</span> <span class="o">=&gt;</span> <span class="kc">true</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="nx">Namespace\To\My\Service\MakesNoSense</span><span class="o">::</span><span class="na">class</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">'shared'</span> <span class="o">=&gt;</span> <span class="kc">false</span>   
    <span class="p">]</span>
<span class="p">];</span>
</pre>
  </td>
</tr>
</tbody>
</table>
</code></pre>
</div>
</div>
<p>If the <code class="highlighter-rouge">shared</code> sub-key does not present, it will be considered as TRUE by default.</p>
<h4 id="inheritance">Inheritance</h4>
<p>In some cases we want to inherit configuration to avoid unnecessary code repeats, and apply only the differences. We
  will be able to do this with the <code class="highlighter-rouge">inherits</code> key. The value must be an existing <code class="highlighter-rouge">service identifier</code>, other than the 
  current one. Both self- of invalid referencing should raise an error.</p>
<p>To make it less complex, let’s say, if any of the sub-key’s value is changed, the full sub-key should be presented. 
  Also, the <code class="highlighter-rouge">shared</code> key must present if differs form the ancestor’s. So if for the ancestor the shared is FALSE, and 
  the descendant should be TRUE, then it must present explicitly, the default behaviour will not applied in this case.</p>
<div class="language-php highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre>
  </td>
  <td class="rouge-code">
    <pre><span class="nv">$config</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'form.service'</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">'class'</span> <span class="o">=&gt;</span> <span class="nx">Namespace\To\Form\Service</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="s1">'argument'</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">'action'</span> <span class="o">=&gt;</span> <span class="s1">'/login.php'</span><span class="p">,</span>
            <span class="s1">'method'</span> <span class="o">=&gt;</span> <span class="s1">'POST'</span>
        <span class="p">],</span>
        <span class="s1">'calls'</span> <span class="o">=&gt;</span> <span class="p">[</span>           
            <span class="p">[</span><span class="s1">'addElement'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'username'</span><span class="p">,</span> <span class="s1">'value'</span> <span class="o">=&gt;</span> <span class="s1">''</span><span class="p">,</span> <span class="nx">\Namespace\To\Form\Element\TextInput</span><span class="o">::</span><span class="na">class</span><span class="p">]],</span>
            <span class="p">[</span><span class="s1">'addElement'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'password'</span><span class="p">,</span> <span class="s1">'value'</span> <span class="o">=&gt;</span> <span class="s1">''</span><span class="p">,</span> <span class="nx">\Namespace\To\Form\Element\PasswordInput</span><span class="o">::</span><span class="na">class</span><span class="p">]],</span>
            <span class="p">[</span><span class="s1">'addElement'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="s1">'submit'</span><span class="p">,</span>  <span class="s1">'value'</span> <span class="o">=&gt;</span> <span class="s1">'Login'</span><span class="p">,</span> <span class="nx">\Namespace\To\Form\Element\SubmitButton</span><span class="o">::</span><span class="na">class</span><span class="p">]],</span>
            <span class="p">[</span><span class="s1">'addValidator'</span><span class="p">,</span> <span class="p">[</span><span class="nx">\Namespace\To\Form\Validator\CredentialValidator</span><span class="o">::</span><span class="na">class</span><span class="p">]],</span>
        <span class="p">],</span>
        <span class="s1">'shared'</span> <span class="o">=&gt;</span> <span class="kc">false</span><span class="p">,</span>   
    <span class="p">],</span>
    <span class="s1">'shared.form.service'</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">'inherits'</span> <span class="o">=&gt;</span> <span class="s1">'form.service'</span><span class="p">,</span>
        <span class="s1">'shared'</span> <span class="o">=&gt;</span> <span class="kc">true</span>
    <span class="p">],</span>
    <span class="s1">'new.form.service'</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">'inherits'</span> <span class="o">=&gt;</span> <span class="s1">'form.service'</span><span class="p">,</span>
        <span class="s1">'argument'</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">'action'</span> <span class="o">=&gt;</span> <span class="s1">'/customer/login'</span><span class="p">,</span>
            <span class="s1">'method'</span> <span class="o">=&gt;</span> <span class="s1">'POST'</span>
        <span class="p">],</span>
    <span class="p">],</span>
<span class="p">];</span>
</pre>
  </td>
</tr>
</tbody>
</table>
</code></pre>
</div>
</div>
<p>And that is all. We covered all the options we need from our DIC implementation to support. And it’s only a very small
  subset of what the YAML is capable of, yet enough for us.</p>
<p>In the next part we will create our DIC implementation.</p>
</div>
<footer class="a-footer">
  <h3 class="a-footer__title">About the author</h3>
  <a class="a-footer__avatar" href="/author/gabor.ivan/index.html"><img src="/author/gabor.ivan/avatar.jpg" alt="Gábor Iván"></a>
  <p class="a-footer__author">
    Hi, my name is Gábor Iván. I am a PHP developer at <a href="https://www.westwing.com" target="_blank" rel="noopener">Westwing</a>, but I also like to deal with the Frontend part too. Of course, in a non-professional way.
    <br>
    <a href="/author/gabor.ivan/index.html">Read the full story</a>
  </p>
</footer>
</article>
<aside class="a-comments">
  <header class="a-comments__title">
    <h4>It's time to judge me!</h4>
  </header>
  <div id="commento">
    It seems like that Commento or JavaScript in general is disabled, so no chance to judge me in public. But don't worry, you can
    <a class="mailto" href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#119;&#111;&#114;&#115;&#116;&#46;&#112;&#114;&#97;&#99;&#116;&#105;&#99;&#101;&#46;&#98;&#108;&#111;&#103;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;?subject=Judgement on `DIY Dependency Injection Container, Part 2`" target="_blank" rel="noopener" rel="noopener noreferrer">write me</a>
    your opinions/ideas/suggestions in email. Please don't forget to reference the page in the message.
  </div>
</aside>
</section>
</main>
<footer class="f-footer">
  <p class="f-footer__copyright">
    <small>Copyright © 2020 All rights reserved. Worst Practice</small>
  </p>
</footer>
</body>
</html>