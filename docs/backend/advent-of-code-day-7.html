<!DOCTYPE html><html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Advent of Code - Day 7&nbsp;-&nbsp;Worst Practice
    </title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=0">
    <meta name="language" content="en">
    <meta name="robots" content="index,follow">
    <meta name="generator" content="jekyll 3.8.5">
    <meta name="revisit-after" content="7 days">
    <meta name="distribution" content="web">
    <meta name="copyright" content="Copyright © 2022 All rights reserved. Worst Practice.">
    <meta name="description" content="
">
    <meta name="subject" content="">
    <meta name="keywords" content="PHP, Advent of Code">
    <!-- facebook share -->
    <meta property="og:locale" content="en_US">
    <meta property="og:site_name" content="Worst Practice">
    <meta property="og:title" content="Advent of Code - Day 7&nbsp;-&nbsp;Worst Practice
">
    <meta property="og:url" content="https://www.worstpractice.dev/backend/advent-of-code-day-7">
    <meta name="date" content="2022-12-07T13:30:00+00:00">
    <meta property="og:image" content="https://www.worstpractice.dev/assets/img/blog/2022/backend/advent-of-code-day-7/advent-7.jpg">
    <meta property="og:image:width" content="600">
    <meta property="og:image:height" content="600">
    <meta property="og:description" content="Dig deep in a folder structure, to find the one.">
    <meta property="fb:admins" content="ivan.gabor.80">
    <meta property="fb:app_id" content="2178081495757871">
    <meta property="og:type" content="article">
    <meta property="article:author" content="https://www.facebook.com/ivan.gabor.80">
    <meta property="article:published_time" content="2022-12-07T13:30:00+00:00">
    <meta property="article:tag" content="blog"/>
    <!-- twitter share -->
    <meta name="twitter:title" content="Advent of Code - Day 7">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:creator" content="@gaborivan1980">
    <meta name="twitter:description" content="Dig deep in a folder structure, to find the one.">
    <meta name="twitter:image" content="https://www.worstpractice.dev/assets/img/blog/2022/backend/advent-of-code-day-7/advent-7_600x600.jpg">
    <link rel="canonical" href="https://www.worstpractice.dev">
    <link rel="alternate" type="application/rss+xml" title="Advent of Code - Day 7&nbsp;-&nbsp;Worst Practice
" href="/feed.xml">
    <link rel="alternate" hreflang="en" href="https://www.worstpractice.dev/backend/advent-of-code-day-7">
    <link rel="apple-touch-icon" sizes="60x60" href="/assets/img/icons/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/assets/img/icons/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/assets/img/icons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/assets/img/icons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/img/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/img/icons/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/img/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/assets/img/icons/android-chrome-192x192.png">
    <link rel="manifest" href="/assets/img/icons/site.webmanifest">
    <link rel="mask-icon" href="/assets/img/icons/safari-pinned-tab.svg" color="#C23F2F">
    <link rel="shortcut icon" href="/assets/img/icons/favicon.ico">
    <meta name="msapplication-TileColor" content="#C23F2F">
    <meta name="msapplication-TileImage" content="/assets/img/icons/mstile-144x144.png">
    <meta name="msapplication-config" content="/assets/img/icons/browserconfig.xml">
    <meta name="theme-color" content="#C23F2F">
    <meta name="application-name" content="Worst Practice Blog">
    <meta name="HandheldFriendly" content="true">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="#C23F2F">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Mono:400">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Libre+Baskerville:300,300i,400,400i,700,700i">
    <link rel="stylesheet" href="/assets/css/site.css">
    <script type="application/javascript" src="/assets/js/feature.min.js"></script>
    <script type="application/javascript">
      if (!feature.srcset) {
          window.location.href = '/sorry.html';
      }
    </script>
    <script type="application/javascript" src="/assets/js/site.min.js"></script>
  </head>
  <body>
    <header class="h-header">
      <h1 class="h-header__title"><a href="/">Worst Practice</a></h1>
    </header>
    <div class="codeOfTheDay">
      <input class="codeOfTheDay__toggle" type="checkbox">
      <div class="codeOfTheDay__content"></div>
      <div class="codeOfTheDay__monitor"></div>
      <div class="codeOfTheDay__backdrop"></div>
    </div>
    <div class="m-menu">
      <div class="m-menu__burger">
        <span></span>
      </div>
      <input class="m-menu__toggle" type="checkbox" />
      <div class="m-menu__content">
        <nav>
          <h2 class="m-menu__title">Worst Practice</h2>
          <ul class="m-menu__navigation">
            <li><a class="m-menu__link -home" href="/">Home</a></li>
          </ul>
        </nav>
        <nav>
          <h2 class="m-menu__title">Categories</h2>
          <ul class="m-menu__navigation">
            <li><a class="m-menu__link -backend -current" href="/backend">Backend</a></li>
            <li><a class="m-menu__link -devenv" href="/devenv">Development Environment</a></li>
            <li><a class="m-menu__link -frontend" href="/frontend">Frontend</a></li>
            <li><a class="m-menu__link -general
" href="/general
">General</a></li>
          </ul>
        </nav>
        <nav>
          <h2 class="m-menu__title">Tags</h2>
          <ul class="m-menu__navigation">
            <li><a class="m-menu__link -php" rel="tag" href="/tags/php/">PHP <sup>18</sup></a></li>
            <li><a class="m-menu__link -advent" rel="tag" href="/tags/advent/">Advent <sup>13</sup></a></li>
            <li><a class="m-menu__link -php74" rel="tag" href="/tags/php74/">PHP 7.4 <sup>4</sup></a></li>
          </ul>
          <a class="m-menu__link -more" href="/tags/">More</a>
        </nav>
        <nav>
          <h2 class="m-menu__title">Archive</h2>
          <ul class="m-menu__navigation">
            <li><a class="m-menu__link " href="/archive/2022-12/">December, 2022</a></li>
            <li><a class="m-menu__link " href="/archive/2022-11/">November, 2022</a></li>
            <li><a class="m-menu__link " href="/archive/2022-10/">October, 2022</a></li>
          </ul>
          <a class="m-menu__link -more" href="/archive/">More</a>
        </nav>
        <nav>
          <ul class="m-menu__navigation">
            <li><a class="m-menu__link " href="/imprint.html">Imprint</a></li>
            <li><a class="m-menu__link " href="/terms.html">Terms of Use</a></li>
            <li><a class="m-menu__link " href="/privacy.html">Privacy Policy</a></li>
          </ul>
        </nav>
      </div>
      <div class="m-menu__backdrop"></div>
    </div>
    <main class="c-content">
      <section class="c-content__article">
        <article class="a-article">
          <header class="a-header">
            <h2 class="a-header__title">Advent of Code - Day 7</h2>
            <div class="a-header__meta">
              <p class="a-meta__date">Posted on December&nbsp; 7, 2022 @ 13:30
              </p>
              <p class="a-meta__category">Posted under the <a href="/backend/index.html">Backend</a> category</p>
              <p class="a-meta__level">Level: beginner</p>
              <p class="a-meta__tags">Posted with the following tags:
                <a href="/tags/advent/index.html">#Advent</a>, 
                <a href="/tags/php/index.html">#PHP</a>
              </p>
            </div>
          </header>
          <p class="a-excerpt">
            Dig deep in a folder structure, to find the one.
          </p>
          <figure class="a-illustration">
            <img class="a-illustration__image" src="/assets/img/post-illustration-placeholder.png" data-src="/assets/img/blog/2022/backend/advent-of-code-day-7/advent-7.jpg" alt="Advent of Code - Day 7">
            <figcaption class="a-illustration__caption">Calendar icon by <a target="_blank" rel="noopener" href="https://pixabay.com/users/pinwhalestock-13691058/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=4623521">Kevin Sanderson</a> from <a target="_blank" rel="noopener" href="https://pixabay.com//?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=4623521">Pixabay</a></figcaption>
          </figure>
          <div class="a-body">
            <p><a href="https://adventofcode.com/2022/day/7" rel="noopener" target="_blank">Today’s puzzle</a> in short: we have a
              filesystem that we need to build up from command history (input), then figure out sizes for different criteria.</p>
            <h3 id="the-input-data">The input data</h3>
            <p>Okay, this one fired up the boosters for sure. The input file has filesystem commands and some responses for the commands:</p>
            <h4 id="the-commands">The commands</h4>
            <p>The commands are normal *nix system commands. The <code class="language-plaintext highlighter-rouge">$</code> represents the command prompt.</p>
            <ul>
              <li><code class="language-plaintext highlighter-rouge">$ cd /</code> - enter the root directory.</li>
              <li><code class="language-plaintext highlighter-rouge">$ cd ..</code> - one level up in the folder structure.</li>
              <li><code class="language-plaintext highlighter-rouge">$ cd xy</code> - enter the <code class="language-plaintext highlighter-rouge">xy</code> directory.</li>
              <li><code class="language-plaintext highlighter-rouge">$ ls</code> - list directory content.</li>
            </ul>
            <h4 id="responses">Responses</h4>
            <p>Only the <code class="language-plaintext highlighter-rouge">ls</code> command produces any output in this input data:</p>
            <ul>
              <li><code class="language-plaintext highlighter-rouge">dir abc</code> - there’s a subdirectory with the name of <code class="language-plaintext highlighter-rouge">abc</code>.</li>
              <li><code class="language-plaintext highlighter-rouge">1234 file.txt</code> - there’s a file with the name of <code class="language-plaintext highlighter-rouge">file.txt</code> and the size of <code class="language-plaintext highlighter-rouge">1234</code> bytes. The filename extension is 
                optional.</li>
            </ul>
            <h4 id="game-rules">Game rules</h4>
            <p>No special rules here. We need to reproduce the file system structure and then calculate different data out of it.</p>
            <h3 id="the-structure">The structure</h3>
            <p>For the first time we need to go into a more advanced mode and create some structure from the input data. Let’s start 
              with this one.</p>
            <p>We read the input data line-by-line and decide what its content is. For both part one and two, we need to deal with 
              directory sizes (that means the sizes all the files and subdirectories of the given directory), we can simplify our 
              structure and collect only the folders and the sizes of their content.</p>
            <div class="language-php highlighter-rouge">
              <div class="highlight">
                <pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
</pre>
              </td>
              <td class="rouge-code">
                <pre><span class="nv">$currentDirectory</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
<span class="nv">$rootDirectory</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">ElfDirectory</span> <span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="nv">$name</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
    <span class="k">public</span> <span class="kt">?ElfDirectory</span> <span class="nv">$parent</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="cd">/** @var array&lt;int, ElfDirectory&gt;  */</span>
    <span class="k">public</span> <span class="kt">array</span> <span class="nv">$children</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="cd">/** @var array&lt;int, string&gt; */</span>
    <span class="k">public</span> <span class="kt">array</span> <span class="nv">$files</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="nv">$totalSize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$fn</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="k">__DIR__</span><span class="mf">.</span><span class="s1">'/input.txt'</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">while</span> <span class="p">((</span><span class="nv">$line</span> <span class="o">=</span> <span class="nb">fgets</span><span class="p">(</span><span class="nv">$fn</span><span class="p">,</span> <span class="mi">1024</span><span class="p">))</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$line</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="nv">$line</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">==</span> <span class="s1">'$ ls'</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">==</span> <span class="s1">'$ cd ..'</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$currentDirectory</span> <span class="o">=</span> <span class="nv">$currentDirectory</span><span class="o">-&gt;</span><span class="k">parent</span><span class="p">;</span>
            <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">==</span> <span class="s1">'$ cd /'</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$newDirectory</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ElfDirectory</span><span class="p">();</span>
            <span class="nv">$newDirectory</span><span class="o">-&gt;</span><span class="n">name</span> <span class="o">=</span> <span class="s1">'/'</span><span class="p">;</span>
            <span class="nv">$currentDirectory</span> <span class="o">=</span> <span class="nv">$rootDirectory</span> <span class="o">=</span> <span class="nv">$newDirectory</span><span class="p">;</span>
            <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nv">$matches</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="s1">'/^\$ cd (?P&lt;dirName&gt;[a-z]+)$/'</span><span class="p">,</span> <span class="nv">$line</span><span class="p">,</span> <span class="nv">$matches</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$newDirectory</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ElfDirectory</span><span class="p">();</span>
            <span class="nv">$newDirectory</span><span class="o">-&gt;</span><span class="n">name</span> <span class="o">=</span> <span class="nv">$matches</span><span class="p">[</span><span class="s1">'dirName'</span><span class="p">];</span>
            <span class="nv">$currentDirectory</span><span class="o">-&gt;</span><span class="n">children</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$newDirectory</span><span class="p">;</span>
            <span class="nv">$newDirectory</span><span class="o">-&gt;</span><span class="k">parent</span> <span class="o">=</span> <span class="nv">$currentDirectory</span><span class="p">;</span>
            <span class="nv">$currentDirectory</span> <span class="o">=</span> <span class="nv">$newDirectory</span><span class="p">;</span>
            <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nv">$matches</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="s1">'/^(?P&lt;fileSize&gt;\d+)\s(?P&lt;fileName&gt;[a-z\.]+)$/'</span><span class="p">,</span> <span class="nv">$line</span><span class="p">,</span> <span class="nv">$matches</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$currentDirectory</span><span class="o">-&gt;</span><span class="n">totalSize</span> <span class="o">+=</span> <span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="nv">$matches</span><span class="p">[</span><span class="s1">'fileSize'</span><span class="p">];</span>
            <span class="nv">$currentDirectory</span><span class="o">-&gt;</span><span class="n">files</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$matches</span><span class="p">[</span><span class="s1">'fileName'</span><span class="p">]</span><span class="mf">.</span><span class="s1">' ('</span><span class="mf">.</span><span class="nv">$matches</span><span class="p">[</span><span class="s1">'fileSize'</span><span class="p">]</span><span class="mf">.</span><span class="s1">')'</span><span class="p">;</span>
            <span class="nv">$parent</span> <span class="o">=</span> <span class="nv">$currentDirectory</span><span class="o">-&gt;</span><span class="k">parent</span><span class="p">;</span>

            <span class="k">while</span> <span class="p">(</span><span class="nv">$parent</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$parent</span><span class="o">-&gt;</span><span class="n">totalSize</span> <span class="o">+=</span> <span class="p">(</span><span class="n">int</span><span class="p">)</span> <span class="nv">$matches</span><span class="p">[</span><span class="s1">'fileSize'</span><span class="p">];</span>
                <span class="nv">$parent</span> <span class="o">=</span> <span class="nv">$parent</span><span class="o">-&gt;</span><span class="k">parent</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="nb">fclose</span><span class="p">(</span><span class="nv">$fn</span><span class="p">);</span>
<span class="p">}</span>
</pre>
              </td>
            </tr>
          </tbody>
        </table>
      </code></pre>
  </div>
</div>
<p>As you see we use a nice and simple PHP class for this task. When we go line-by-line through the file, we check with 
  exact comparison and with regular expression the actual line:</p>
<ul>
  <li>When it’s an <code class="language-plaintext highlighter-rouge">ls</code> command, it’s just a placeholder, we can ignore it.</li>
  <li>When it’s a <code class="language-plaintext highlighter-rouge">cd ..</code> command, it means the <code class="language-plaintext highlighter-rouge">$currentDirectory</code> pointer should point to its parent element.</li>
  <li>When it’s a <code class="language-plaintext highlighter-rouge">cd /</code> command, we need to initialize the root level directory. We save it into both the <code class="language-plaintext highlighter-rouge">$currentDirectory</code>
    and the <code class="language-plaintext highlighter-rouge">$rootDirectory</code></li>
  <li>When we enter into a subdirectory, we create a new <code class="language-plaintext highlighter-rouge">ElfDirectory</code> instance, add it to the <code class="language-plaintext highlighter-rouge">$currentDirectory</code>’s children 
    list, and set the <code class="language-plaintext highlighter-rouge">$currentDirectory</code> as the parent of this directory instance. Then we set this new instance as the 
    <code class="language-plaintext highlighter-rouge">$currentDirectory</code>.</li>
  <li>When it’s directory listing row, and it’s a file, we increment the <code class="language-plaintext highlighter-rouge">$currentDirectory</code> size counter with the actual file
    size. To make our future life easier, we also iterate through the parent element(s) and increment their size counters 
    as well.</li>
  <li>When it’s directory listing row, and it’s a directory, we ignore it, the <code class="language-plaintext highlighter-rouge">cd</code> command will do the registration.</li>
</ul>
<p>As you see we also store the file name with the file size in a string within the <code class="language-plaintext highlighter-rouge">ElfDirectory</code>. However, it’s not necessary
  I still added it, because we will have a bonus function in the end, which can visually display the folder structure in the 
  terminal.</p>
<h3 id="part-one">Part one</h3>
<p>In part one, we need to analyze the file system and count all the folder sizes that are below <strong>100000</strong> bytes. As in the
  puzzle description is written, with this method we most likely will have redundant counts:</p>
<ul>
  <li>If folder “B” size within folder “A” is 3000,</li>
  <li>…and folder “A” size is 5000,</li>
  <li>…then both folder “A” and folder “B” is below 100000, so we count 8000, although folder “A”’s size counter already contains
    the size of folder “B”.</li>
</ul>
<p>What can we say? <code class="language-plaintext highlighter-rouge">¯\_(ツ)_/¯</code>.</p>
<p>To find the answer for the question, we need to create a recursive function that can climb the tree and check every element 
  of it:</p>
<div class="language-php highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre>
  </td>
  <td class="rouge-code">
    <pre><span class="k">const</span> <span class="no">DIRECTORY_CHECK_MAX_SIZE</span> <span class="o">=</span> <span class="mi">100000</span><span class="p">;</span>

<span class="k">function</span> <span class="n">calculateTotalSumOf10kFolders</span><span class="p">(</span><span class="kt">ElfDirectory</span> <span class="nv">$directory</span><span class="p">):</span> <span class="kt">int</span>
<span class="p">{</span>
    <span class="nv">$sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$directory</span><span class="o">-&gt;</span><span class="n">totalSize</span>  <span class="o">&lt;=</span> <span class="no">DIRECTORY_CHECK_MAX_SIZE</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$sum</span> <span class="o">+=</span> <span class="nv">$directory</span><span class="o">-&gt;</span><span class="n">totalSize</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$directory</span><span class="o">-&gt;</span><span class="n">children</span> <span class="k">as</span> <span class="nv">$subDirectory</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$sum</span> <span class="o">+=</span> <span class="nf">calculateTotalSumOf10kFolders</span><span class="p">(</span><span class="nv">$subDirectory</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$sum</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">echo</span> <span class="nf">calculateTotalSumOf10kFolders</span><span class="p">(</span><span class="nv">$rootDirectory</span><span class="p">)</span><span class="mf">.</span><span class="kc">PHP_EOL</span><span class="p">;</span>
</pre>
  </td>
</tr>
</tbody>
</table>
</code></pre>
</div>
</div>
<h3 id="part-two">Part two</h3>
<p>Here we need to find the smallest directory that is larger than a specific size. What is this specific size? So we know that
  the total disk space is 70000000 bytes, and the update requires 30000000 bytes of free space. We also know, how much our
  filesystem totally consumes (which is the <code class="language-plaintext highlighter-rouge">totalSize</code> of the root directory). From these, we can calculate how much space
  we need more to fulfill the free space requirement of the update. We need to find one folder that frees up enough space
  upon deletion.</p>
<div class="language-php highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre>
  </td>
  <td class="rouge-code">
    <pre><span class="k">const</span> <span class="no">TOTAL_DISK_SPACE</span> <span class="o">=</span> <span class="mi">70000000</span><span class="p">;</span>
<span class="k">const</span> <span class="no">MINIMUM_UPDATE_SPACE_REQUIRED</span> <span class="o">=</span> <span class="mi">30000000</span><span class="p">;</span>

<span class="k">function</span> <span class="n">findSmallestDirectoryFreesUpEnoughSpace</span><span class="p">(</span><span class="kt">ElfDirectory</span> <span class="nv">$directory</span><span class="p">,</span> <span class="kt">int</span> <span class="nv">$actualMinimum</span><span class="p">,</span> <span class="kt">int</span> <span class="nv">$limit</span><span class="p">):</span> <span class="kt">int</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$directory</span><span class="o">-&gt;</span><span class="n">totalSize</span> <span class="o">&gt;</span> <span class="nv">$limit</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$actualMinimum</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nv">$actualMinimum</span><span class="p">,</span> <span class="nv">$directory</span><span class="o">-&gt;</span><span class="n">totalSize</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$directory</span><span class="o">-&gt;</span><span class="n">children</span> <span class="k">as</span> <span class="nv">$subDirectory</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$actualMinimum</span> <span class="o">=</span> <span class="nf">findSmallestDirectoryFreesUpEnoughSpace</span><span class="p">(</span><span class="nv">$subDirectory</span><span class="p">,</span> <span class="nv">$actualMinimum</span><span class="p">,</span> <span class="nv">$limit</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$actualMinimum</span><span class="p">;</span>
<span class="p">}</span>

<span class="nv">$actualFreeSpace</span> <span class="o">=</span> <span class="no">TOTAL_DISK_SPACE</span> <span class="o">-</span> <span class="nv">$rootDirectory</span><span class="o">-&gt;</span><span class="n">totalSize</span><span class="p">;</span>
<span class="nv">$spaceNeeded</span> <span class="o">=</span> <span class="no">MINIMUM_UPDATE_SPACE_REQUIRED</span> <span class="o">-</span> <span class="nv">$actualFreeSpace</span><span class="p">;</span>
<span class="k">echo</span> <span class="nf">findSmallestDirectoryFreesUpEnoughSpace</span><span class="p">(</span><span class="nv">$rootDirectory</span><span class="p">,</span> <span class="nv">$rootDirectory</span><span class="o">-&gt;</span><span class="n">totalSize</span><span class="p">,</span> <span class="nv">$spaceNeeded</span><span class="p">)</span><span class="mf">.</span><span class="kc">PHP_EOL</span><span class="p">;</span>

</pre>
  </td>
</tr>
</tbody>
</table>
</code></pre>
</div>
</div>
<p>Of course, we don’t make extra checks whether there’s enough free space or not.</p>
<h3 id="bonus">Bonus</h3>
<p>I promised a bonus. It’s ugly as hell, and it can be optimized a lot, but for now it’s a good start. So the “not-so-proper”
  <code class="language-plaintext highlighter-rouge">tree</code> command:</p>
<div class="language-php highlighter-rouge">
  <div class="highlight">
    <pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre>
  </td>
  <td class="rouge-code">
    <pre><span class="k">function</span> <span class="n">tree</span><span class="p">(</span><span class="kt">ElfDirectory</span> <span class="nv">$directory</span><span class="p">,</span> <span class="kt">int</span> <span class="nv">$level</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span> <span class="kt">void</span>
<span class="p">{</span>
    <span class="k">echo</span> <span class="nb">str_repeat</span><span class="p">(</span><span class="s1">' | '</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nv">$level</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="mf">.</span><span class="p">(</span><span class="nv">$level</span> <span class="o">?</span> <span class="s1">' ├'</span> <span class="o">:</span><span class="s1">''</span><span class="p">)</span>
        <span class="mf">.</span><span class="s1">'['</span><span class="mf">.</span><span class="nv">$directory</span><span class="o">-&gt;</span><span class="n">name</span><span class="mf">.</span><span class="s1">'] ('</span><span class="mf">.</span><span class="nv">$directory</span><span class="o">-&gt;</span><span class="n">totalSize</span><span class="mf">.</span><span class="s1">')'</span><span class="mf">.</span><span class="kc">PHP_EOL</span><span class="p">;</span>

    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$directory</span><span class="o">-&gt;</span><span class="n">children</span> <span class="k">as</span> <span class="nv">$subDir</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">tree</span><span class="p">(</span><span class="nv">$subDir</span><span class="p">,</span> <span class="nv">$level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$directory</span><span class="o">-&gt;</span><span class="n">files</span> <span class="k">as</span> <span class="nv">$file</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="nb">str_repeat</span><span class="p">(</span><span class="s1">' | '</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nv">$level</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="mf">.</span><span class="p">(</span><span class="nv">$level</span> <span class="o">?</span> <span class="s1">' | '</span> <span class="o">:</span><span class="s1">''</span><span class="p">)</span><span class="mf">.</span><span class="s1">' └'</span><span class="mf">.</span><span class="nv">$file</span><span class="mf">.</span><span class="kc">PHP_EOL</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre>
  </td>
</tr>
</tbody>
</table>
</code></pre>
</div>
</div>
<p>It will look something like this:</p>
<figure class="a-illustration">
  <img class="a-illustration__image" src="/assets/img/post-illustration-placeholder.png" data-src="/assets/img/blog/2022/backend/advent-of-code-day-7/visual.png" width="480" />
  <figcaption class="a-illustration__caption">Output sample of the tree function.</figcaption>
</figure>
</div>
<footer class="a-footer">
  <h3 class="a-footer__title">About the author</h3>
  <a class="a-footer__avatar" href="/author/gabor.ivan/index.html"><img src="/author/gabor.ivan/avatar.jpg" alt="Gábor Iván"></a>
  <p class="a-footer__author">
    Hi, my name is Gábor Iván. I am an old-school Full stack developer, which means I deal with Backend (PHP), Frontend (HTML, CSS, JS), and a little bit of Webdesign. No DevOPS, sorry.
    <br>
    <a href="/author/gabor.ivan/index.html">Read the full story</a>
  </p>
</footer>
</article>
<aside class="a-comments">
  <header class="a-comments__title">
    <h4>It's time to judge me!</h4>
  </header>
  <div id="general">
    There's no embedded tool to judge me in public. But don't worry, you can
    <a class="mailto" href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#119;&#111;&#114;&#115;&#116;&#46;&#112;&#114;&#97;&#99;&#116;&#105;&#99;&#101;&#46;&#98;&#108;&#111;&#103;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;?subject=Judgement on `Advent of Code - Day 7`" target="_blank" rel="noopener" rel="noopener noreferrer">write me</a>
    your opinions/ideas/suggestions in email. Please don't forget to reference the page in the message.
  </div>
</aside>
</section>
</main>
<footer class="f-footer">
  <p class="f-footer__copyright">
    <small>Copyright © 2022 All rights reserved. Worst Practice</small>
  </p>
</footer>
</body>
</html>